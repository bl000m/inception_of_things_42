# Vagrant.configure("2") do |config|
#   config.vm.define "Server" do |server|
#     server.vm.provider "docker" do |docker|
#       docker.image = "ubuntu:20.04"
#       docker.remains_running = false
#       docker.cmd = ["echo", "Hello, Vagrant!"]

#     end
#   end

#   config.vm.define "ServerWorker" do |server_worker|
#     server_worker.vm.provider "docker" do |docker|
#       docker.image = "ubuntu:20.04"
#       docker.remains_running = false
#       docker.cmd = ["echo", "Hello, Vagrant!"]
#     end
#   end
# end

Vagrant.configure("2") do |config|
  # Configuration for Server machine
  config.vm.define "serverS" do |server|
    server.vm.box = "your_base_box"  # Specify the base box of your choice
    server.vm.hostname = "serverS"
    server.vm.network "private_network", type: "dhcp", adapter: 1  # Use DHCP on eth1
    server.vm.network "forwarded_port", guest: 22, host: 2222, id: "ssh"  # Forward SSH port for convenience
    server.vm.provider "virtualbox" do |vb|
      vb.cpus = 1
      vb.memory = 512  # Adjust memory as needed
    end
    server.vm.provision "shell", inline: <<-SHELL
      # Install K3s in controller mode
      curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="--flannel-iface=eth1" sh -
    SHELL
  end

  # Configuration for ServerWorker machine
  config.vm.define "serverWorkerSW" do |server_worker|
    server_worker.vm.box = "your_base_box"  # Specify the base box of your choice
    server_worker.vm.hostname = "serverWorkerSW"
    server_worker.vm.network "private_network", type: "dhcp", adapter: 1  # Use DHCP on eth1
    server_worker.vm.network "forwarded_port", guest: 22, host: 2223, id: "ssh"  # Forward SSH port for convenience
    server_worker.vm.provider "virtualbox" do |vb|
      vb.cpus = 1
      vb.memory = 512  # Adjust memory as needed
    end
    server_worker.vm.provision "shell", inline: <<-SHELL
      # Install K3s in agent mode
      curl -sfL https://get.k3s.io | K3S_URL=https://192.168.56.110:6443 K3S_TOKEN=your_token sh -
    SHELL
  end
end
